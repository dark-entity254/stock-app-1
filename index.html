<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3Z Terminal - Risk Intelligence</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { --neon-green: #39ff14; --neon-red: #ff3131; --neon-cyan: #00ffff; --gold: #ffd700; --bg: #0a0f1a; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Inter', sans-serif; }
        .app-container { max-width: 450px; margin: auto; padding: 20px; }
        
        /* Risk Meter UI */
        .risk-box {
            background: rgba(255,255,255,0.03); border: 1px solid #334155;
            border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;
        }
        .meter-bg { width: 100%; height: 8px; background: #1e293b; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        #risk-fill { width: 0%; height: 100%; transition: 1s ease-in-out; }
        
        .total-equity-bar { background: rgba(255,215,0,0.05); border: 1px solid var(--gold); border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 20px; }
        .total-val { font-size: 2.5rem; font-weight: 900; color: var(--gold); }

        .pl-card { background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; margin: 15px 0; border: 1px solid rgba(255,215,0,0.3); }
        input { width: 100%; padding: 12px; margin: 5px 0; background: rgba(255,255,255,0.07); border: 1px solid var(--neon-cyan); border-radius: 8px; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; background: var(--gold); color: black; }
    </style>
</head>
<body>

    <div id="main-content" class="app-container">
        <div class="total-equity-bar">
            <small>TOTAL EQUITY</small>
            <div id="grand-total" class="total-val">$0.00</div>
            <div id="total-pl-combined" style="font-size: 0.8rem;">P&L: $0.00 (0.00%)</div>
        </div>

        <div class="risk-box">
            <small id="risk-status">DIVERSIFICATION METER</small>
            <div class="meter-bg"><div id="risk-fill"></div></div>
            <div id="risk-alert" style="font-size: 0.7rem; color: #94a3b8;">Loading risk data...</div>
        </div>

        <div class="pl-card">
            <div style="display:flex; gap:8px;">
                <input type="text" id="ticker" placeholder="SYMBOL">
                <button onclick="updateTerminal()" style="width:80px; margin:0;">GO</button>
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="number" id="buyPrice" placeholder="Buy $">
                <input type="number" id="quantity" placeholder="Qty">
            </div>
            <button onclick="savePosition()">SAVE TO PORTFOLIO</button>
        </div>

        <canvas id="traderChart"></canvas>
    </div>

    <script>
        // CONFIG (Replace with your keys)
        const firebaseConfig = {apiKey: "AIzaSyAgiu-mJecT8FdmGnHuc0bHiMHRcWoHmjk",
  authDomain: "d3z-terminal.firebaseapp.com",
  projectId: "d3z-terminal",
  storageBucket: "d3z-terminal.firebasestorage.app",
  messagingSenderId: "805005494085",
  appId: "1:805005494085:web:42ff58007357e67bf9202c",
  measurementId: "G-JX0C1GV372"
            apiKey: "...", authDomain: "...", projectId: "...", storageBucket: "...", appId: "..." };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        async function loadPortfolio() {
            const user = auth.currentUser;
            if (!user) return;

            let totalInvested = 0;
            let totalCurrentValue = 0;
            let maxHoldingVal = 0;
            let maxHoldingSymbol = "";

            const snap = await db.collection('portfolio').doc(user.uid).collection('trades').get();
            
            for (const doc of snap.docs) {
                const data = doc.data();
                const price = await fetchPrice(data.symbol); // Your API call
                
                const currentVal = price * data.qty;
                const costBasis = data.buyPrice * data.qty;
                
                totalInvested += costBasis;
                totalCurrentValue += currentVal;

                if (currentVal > maxHoldingVal) {
                    maxHoldingVal = currentVal;
                    maxHoldingSymbol = data.symbol;
                }
            }

            updateRiskMeter(totalCurrentValue, maxHoldingVal, maxHoldingSymbol);
            updateSummaryUI(totalInvested, totalCurrentValue);
        }

        function updateRiskMeter(total, maxVal, symbol) {
            const concentration = total > 0 ? (maxVal / total) * 100 : 0;
            const fill = document.getElementById('risk-fill');
            const status = document.getElementById('risk-status');
            const alertBox = document.getElementById('risk-alert');

            fill.style.width = concentration + "%";
            
            if (concentration > 40) {
                fill.style.backgroundColor = "var(--neon-red)";
                status.innerText = "HIGH CONCENTRATION RISK";
                alertBox.innerText = `WARNING: ${symbol} makes up ${concentration.toFixed(1)}% of your portfolio. Consider diversifying.`;
            } else if (concentration > 20) {
                fill.style.backgroundColor = "var(--gold)";
                status.innerText = "MODERATE CONCENTRATION";
                alertBox.innerText = `${symbol} is your largest holding.`;
            } else {
                fill.style.backgroundColor = "var(--neon-green)";
                status.innerText = "DIVERSIFIED PORTFOLIO";
                alertBox.innerText = "Your assets are well-spread across your holdings.";
            }
        }

        async function fetchPrice(symbol) { return (Math.random() * 100) + 50; } // Replace with real API
        function updateSummaryUI(invested, current) {
            document.getElementById('grand-total').innerText = "$" + current.toLocaleString();
        }
        auth.onAuthStateChanged(user => { if(user) loadPortfolio(); });
        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAgiu-mJecT8FdmGnHuc0bHiMHRcWoHmjk",
  authDomain: "d3z-terminal.firebaseapp.com",
  projectId: "d3z-terminal",
  storageBucket: "d3z-terminal.firebasestorage.app",
  messagingSenderId: "805005494085",
  appId: "1:805005494085:web:42ff58007357e67bf9202c",
  measurementId: "G-JX0C1GV372"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAgiu-mJecT8FdmGnHuc0bHiMHRcWoHmjk",
    authDomain: "d3z-terminal.firebaseapp.com",
    projectId: "d3z-terminal",
    storageBucket: "d3z-terminal.firebasestorage.app",
    messagingSenderId: "805005494085",
    appId: "1:805005494085:web:42ff58007357e67bf9202c",
    measurementId: "G-JX0C1GV372"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAgiu-mJecT8FdmGnHuc0bHiMHRcWoHmjk",
  authDomain: "d3z-terminal.firebaseapp.com",
  projectId: "d3z-terminal",
  storageBucket: "d3z-terminal.firebasestorage.app",
  messagingSenderId: "805005494085",
  appId: "1:805005494085:web:42ff58007357e67bf9202c",
  measurementId: "G-JX0C1GV372"
};
</script>
    
    </script>
</body>
</html>
